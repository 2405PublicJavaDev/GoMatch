<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>소모임 개설하기 - GoMatch</title>
  <link rel="stylesheet" href="/css/meeting-register.css">
  <link rel="stylesheet" href="/css/header-footer.css">
  <style>
    /* 필요한 스타일을 여기에 작성하세요 */
  </style>
</head>
<body>
<header>
  <nav>
    <div class="logo">
      <img src="img/고매치로고.png" alt="야구 리그 로고">
    </div>
    <ul class="nav-links">
      <li><a href="#">일정/결과</a></li>
      <li><a href="#">굿즈</a></li>
      <li><a href="#">소모임</a></li>
      <li><a href="#">승부예측</a></li>
    </ul>
    <ul class="member-links">
      <li><a href="loginpage.html">로그인</a></li>
      <li><a href="#">회원가입</a></li>
    </ul>
  </nav>
</header>

<main>
  <h1>소모임 개설하기</h1>
  <form action="/meeting/register" method="post" onsubmit="return validateForm()">
    <!-- 응원하는 팀 선택 -->
    <div class="form-group">
      <label for="meetingTeamName">응원하는 팀명</label>
      <select id="meetingTeamName" name="meetingTeamName" required>
        <option value="">선택하세요</option>
        <option value="두산">두산 베어스</option>
        <option value="삼성">삼성 라이온즈</option>
        <option value="키움">키움 히어로즈</option>
        <option value="KT">KT 위즈</option>
        <option value="LG">LG 트윈스</option>
        <option value="NC">NC 다이노스</option>
        <option value="SSG">SSG 랜더스</option>
        <option value="롯데">롯데 자이언츠</option>
        <option value="KIA">KIA 타이거즈</option>
        <option value="한화">한화 이글스</option>
      </select>
    </div>

    <!-- 경기 날짜 선택 -->
    <div class="form-group">
      <label for="gameNo">경기 날짜</label>
      <input type="date" id="gameNo" name="gameNo" required>
    </div>

    <!-- 경기 정보 선택 -->
    <div class="form-group">
      <label for="gameInfo">경기 정보</label>
      <select id="gameInfo" name="gameInfo" required>
        <option value="">경기를 선택하세요</option>
      </select>
    </div>

    <!-- 모임 시간 선택 -->
    <div class="form-group">
      <label for="meetingTime">모임 시간</label>
      <input type="time" id="meetingTime" name="meetingTime" required step="900">
    </div>

    <!-- 모임 위치 검색 -->
    <div class="form-group">
      <label for="meetingPlace">모임 위치</label>
      <input type="text" id="meetingPlace" name="meetingPlace" placeholder="주소를 검색하세요" required readonly>
      <button type="button" onclick="searchAddress();">검색</button>
    </div>

    <!-- 최대 참석 인원 -->
    <div class="form-group">
      <label for="meetingMemberCount">최대 참석 인원</label>
      <input type="number" id="meetingMemberCount" name="meetingMemberCount" min="1" max="20" placeholder="최대 20명까지 입력 가능" required>
    </div>

    <!-- 모임 제목 -->
    <div class="form-group">
      <label for="meetingTitle">모임 제목</label>
      <input type="text" id="meetingTitle" name="meetingTitle" placeholder="모임의 제목을 입력해주세요" required>
    </div>

    <!-- 모임 내용 -->
    <div class="form-group">
      <label for="meetingContent">모임 내용</label>
      <textarea id="meetingContent" name="meetingContent" placeholder="모임의 내용을 입력해주세요" required></textarea>
    </div>

    <!-- 사진 첨부 -->
    <div class="form-group">
      <label for="groupImage">사진 첨부</label>
      <input type="file" id="groupImage" name="groupImage" accept="image/*">
    </div>

    <div class="buttons">
      <button type="submit" class="submit">등록</button>
      <button type="button" class="cancel" onclick="history.back()">취소</button>
    </div>
  </form>
</main>

<footer class="footer-page">
  <div class="footer-content">
    <div class="logo">
      <img src="img/고매치로고.png" alt="GoMatch 로고">
    </div>
    <div class="footer-text">
      <p>개인정보 처리방침</p>
      <p>(사)GoMatch｜서울 중구 남대문로 120 대경빌딩 3층｜02)1544-1515</p>
      <p>Copyright © GoMatch</p>
    </div>
  </div>
</footer>

<!-- Script 부분 -->
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  // 오늘 날짜 이후로만 선택 가능하도록 설정
  const today = new Date();
  const sixMonthsLater = new Date();
  sixMonthsLater.setMonth(today.getMonth() + 6);

  const todayStr = today.toISOString().split('T')[0];
  const sixMonthsLaterStr = sixMonthsLater.toISOString().split('T')[0];

  document.getElementById('gameNo').setAttribute('min', todayStr);
  document.getElementById('gameNo').setAttribute('max', sixMonthsLaterStr);

  // 경기 날짜 선택 시 AJAX로 해당 날짜의 경기 정보 조회
  $('#gameNo').on('change', function() {
    const selectedDate = $(this).val();
    if (selectedDate) {
      $.ajax({
        url: '/meeting/games', // 서버의 매핑된 URL
        method: 'GET',
        data: { date: selectedDate },
        success: function(response) {
          $('#gameInfo').html(response);  // 경기 정보를 gameInfo 셀렉트 박스에 갱신
        },
        error: function(xhr, status, error) {
          console.error('AJAX 에러:', error);
        }
      });
    }
  });

  // 주소 검색 API 호출
  function searchAddress() {
    new daum.Postcode({
      oncomplete: function(data) {
        document.querySelector("#meetingPlace").value = data.address;
      }
    }).open();
  }

  // 시간 입력 필드에 대한 추가 제한
  document.getElementById('meetingTime').addEventListener('change', function() {
    const time = this.value;
    const [hours, minutes] = time.split(':');
    const validMinutes = ['00', '10', '20', '30', '40', '50'];

    if (!validMinutes.includes(minutes)) {
      // 가장 가까운 유효한 분 단위 찾기
      const nearestValidMinute = validMinutes.reduce((a, b) => {
        return Math.abs(b - minutes) < Math.abs(a - minutes) ? b : a;
      });

      // 시간 필드를 자동으로 수정하고 알림창 띄우기
      this.value = `${hours}:${nearestValidMinute}`;
      alert("분은 00, 10, 20, 30, 40, 50 단위로 설정해야 합니다.");
    }
  });

  // 경기 날짜 유효성 검사 함수
  function validateForm() {
    const gameDate = document.getElementById('gameNo').value;
    if (gameDate < todayStr) {
      alert("지난 날짜는 선택할 수 없습니다.");
      return false; // 제출 중지
    }
    return true;
  }
</script>
</body>
</html>
