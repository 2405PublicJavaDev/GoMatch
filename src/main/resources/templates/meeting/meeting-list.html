<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>소모임 리스트</title>
    <!-- 메인 css -->
    <link rel="stylesheet" href="/css/meeting-list.css">
    <!-- 헤더/푸터 CSS-->
    <link rel="stylesheet" href="/css/header-footer.css">
    <!-- FullCalendar CSS 로드 -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@5.10.2/main.min.css' rel='stylesheet'/>
    <!-- 페이지네이션 CSS-->
    <link rel="stylesheet" href="/css/pagination.css">
</head>
<body>

<header>
    <nav>
        <div class="logo">
            <img src="/img/고매치로고.png" alt="야구 리그 로고">
        </div>
        <ul class="nav-links">
            <li><a href="#">일정/결과</a></li>
            <li><a href="#">굿즈</a></li>
            <li><a href="#">소모임</a></li>
            <li><a href="#">승부예측</a></li>
        </ul>
        <ul class="member-links">
            <li><a href="loginpage.html">로그인</a></li>
            <li><a href="#">회원가입</a></li>
        </ul>
    </nav>
</header>

<main>
    <div class="container">
        <h1>소모임 리스트</h1>

        <!-- 달력 및 필터를 같은 행에 배치하기 위한 컨테이너 -->
        <div class="content-container">
            <!-- 날짜별 달력 영역 -->
            <div class="calendar-container">
                <h3>날짜별</h3>
                <div id="calendar"></div>
            </div>

            <!-- 팀별 필터 영역 -->
            <div class="filter-container">
                <h3>팀별</h3>
                <div class="tags">
                    <div class="tag" onclick="filterByTeam('전체')">전체</div>
                    <div class="tag" th:each="team : ${teams}" th:text="${team}" onclick="filterByTeam('${team}')"></div>
                </div>
            </div>
        </div>

        <button class="button">소모임 개설하기</button>

        <div style="clear: both;">
            <span>* Total : <span id="total-count">0</span> 건</span>
            <span style="float: right;">Page : 1 / 1</span>
        </div>

        <div id="meeting-list" class="items">
            <!-- 소모임 리스트 출력 -->
            <div th:each="meeting : ${meetings}" class="item">
                <div class="item-image"></div>
                <div class="item-content">
                    <h3 th:text="${meeting.meetingTeamName}">팀 이름</h3>
                    <p th:text="${meeting.meetingTime}">경기 시간</p>
                    <p th:text="${meeting.meetingTitle}">소모임 제목</p>
                    <p>인원 현황 : <span th:text="${meeting.meetingMaxPeople}">0</span>명</p>
                </div>
            </div>
        </div>

        <div id="no-meetings" class="no-meetings" th:if="${#lists.isEmpty(meetings)}">
            개설된 소모임이 없습니다.
        </div>

    </div>

</main>


<footer class="footer-page">
    <div class="footer-content">
        <div class="logo">
            <img src="img/고매치로고.png" alt="GoMatch 로고">
        </div>
        <div class="footer-text">
            <p>개인정보 처리방침</p>
            <p>(사)GoMatch｜서울 중구 남대문로 120 대경빌딩 3층｜02)1544-1515</p>
            <p>Copyright © GoMatch</p>
        </div>
    </div>
</footer>
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@5.10.2/main.min.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        var selectedDate = null;
        var selectedTeam = '전체';

        // FullCalendar 설정
        var calendarEl = document.getElementById('calendar');
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            height: 300,
            contentHeight: 300,
            dateClick: function(info) {
                // 선택된 날짜 색상 변경
                if (selectedDate) {
                    document.querySelector(`[data-date='${selectedDate}']`).classList.remove('fc-day-selected');
                }
                selectedDate = info.dateStr;
                document.querySelector(`[data-date='${selectedDate}']`).classList.add('fc-day-selected');

                loadMeetings(); // 날짜 클릭 시 소모임 리스트 불러오기
            },
            datesSet: function(info) {
                // 새로운 달로 이동할 때 선택된 날짜 초기화
                selectedDate = null;
                // 날짜 클릭 이벤트가 새로운 달에도 적용되도록 함
                console.log("달이 변경되었습니다:", info.startStr, "부터", info.endStr);
            }
        });
        calendar.render();

        // 팀 필터링 함수
        function filterByTeam(team) {
            selectedTeam = team;
            document.querySelectorAll('.tag').forEach(tag => tag.classList.remove('active'));
            document.querySelector(`.tag[onclick*="'${team}'"]`).classList.add('active');

            loadMeetings(); // 팀 클릭 시 소모임 리스트 불러오기
        }

        function loadMeetings() {
            fetch(`/meeting/listByDateAndTeam?date=${selectedDate}&team=${selectedTeam}`)
                .then(response => response.json())
                .then(data => {
                    var meetingList = document.getElementById("meeting-list");
                    meetingList.innerHTML = ''; // 기존 리스트 초기화

                    if (data.length === 0) {
                        document.getElementById("no-meetings").style.display = 'block';
                    } else {
                        document.getElementById("no-meetings").style.display = 'none';

                        data.forEach(meeting => {
                            var item = document.createElement("div");
                            item.classList.add("item");

                            item.innerHTML = `
                    <div class="item-image"></div>
                    <div class="item-content">
                        <h3>${meeting.meetingTeamName}</h3>
                        <p>${meeting.meetingTime}</p>
                        <p>${meeting.meetingTitle}</p>
                        <p>인원 현황 : ${meeting.meetingMaxPeople}명</p>
                    </div>
                `;
                            meetingList.appendChild(item);
                        });
                    }

                    document.getElementById("total-count").textContent = data.length;
                });
        }


        // 팀 이름에 따른 로고 이미지 경로를 반환하는 함수
        function getTeamLogo(teamName) {
            switch (teamName) {
                case 'KT':
                    return '/img/KT로고.png';
                case 'LG':
                    return '/img/LG로고.png';
                case 'NC':
                    return '/img/NC로고.png';
                case 'SSG':
                    return '/img/SSG로고.png';
                case '기아':
                    return '/img/기아로고.png';
                case '두산':
                    return '/img/두산로고.png';
                case '롯데':
                    return '/img/롯데로고.png';
                case '삼성':
                    return '/img/삼성로고.png';
                case '키움':
                    return '/img/키움로고.png';
                case '한화':
                    return '/img/한화로고.png';
                default:
                    return '/img/default-logo.png'; // 기본 로고 이미지 (없을 경우)
            }
        }
    });



</script>
</body>
</html>
