<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>상품 상세 조회</title>
  <style>
    .btn {
      cursor: pointer;
      font-size: 18px;
      padding: 10px 20px;
      background-color: gray;
      color: white;
      border: none;
      border-radius: 5px;
      margin-right: 10px;
    }

    .wishlist-button.active {
      background-color: red; /* 찜하기 버튼 활성화 색상 */
    }
  </style>
</head>
<body>
<h1 th:text="${goods.goodsProductName}"></h1>
<p>상품 번호: <span th:text="${goods.goodsNo}"></span></p>
<p>팀: <span th:text="${goods.goodsTeam}"></span></p>
<p>가격: <span th:text="${goods.goodsPrice}"></span></p>
<p>상품 코드: <span th:text="${goods.goodsProductCode}"></span></p>
<p>제조일: <span th:text="${goods.goodsMakeDate}"></span></p>
<p>출시일: <span th:text="${goods.goodsOutDate}"></span></p>
<p>카테고리: <span th:text="${goods.goodsCategory}"></span></p>

<a href="/goods/list" class="btn">목록</a>

<button id="wishlistButton"
        class="btn wishlist-button"
        th:classappend="${isWishlisted} ? ' active' : ''"
        th:onclick="'toggleWishlist(' + ${goods.goodsNo} + ')'">
  <span th:text="${isWishlisted} ? '찜하기 취소' : '찜하기'"></span>
</button>

<script th:inline="javascript">
  function toggleWishlist(goodsNo) {
    console.log('goodsNo:', goodsNo); // 디버깅을 위한 로그

    // goodsNo가 올바르게 전달되었는지 확인
    if (typeof goodsNo === 'undefined' || goodsNo === null) {
      console.error('Invalid goodsNo'); // 오류 로그
      return; // 잘못된 goodsNo가 전달되면 함수 종료
    }

    fetch('/wishlist?goodsNo=' + goodsNo, {
      method: 'POST',
      credentials: 'include' // 쿠키와 인증정보 포함
    })
            .then(response => {
              if (response.redirected) {
                // 로그인하지 않은 경우 로그인 페이지로 리디렉션
                window.location.href = response.url;
              } else {
                // 로그인된 경우 버튼 상태 변경
                return response.json(); // JSON 응답을 받음
              }
            })
            .then(data => {
              // 버튼 색상 및 텍스트 변경
              const button = document.getElementById('wishlistButton');
              const isActive = button.classList.contains('active');
              button.classList.toggle('active', !isActive); // 클래스 토글
              button.innerText = isActive ? '찜하기' : '찜하기 취소'; // 버튼 텍스트 변경
            })
            .catch(error => console.error('Error:', error));
  }
</script>
</body>
</html>
