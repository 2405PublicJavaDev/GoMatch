<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>상품 상세 조회</title>
  <style>
    /* 공통 버튼 스타일 */
    .btn {
      cursor: pointer;
      font-size: 18px;
      padding: 10px 20px;
      background-color: gray;
      color: white;
      border: none;
      border-radius: 5px;
      margin-right: 10px; /* 버튼 간의 간격 */
    }

    /* 찜하기 버튼의 추가 스타일 */
    .wishlist-button.active {
      background-color: red; /* 찜한 상태일 때 색상 */
    }
  </style>
</head>
<body>
<h1 th:text="${goods.goodsProductName}"></h1>
<p>상품 번호: <span th:text="${goods.goodsNo}"></span></p>
<p>팀: <span th:text="${goods.goodsTeam}"></span></p>
<p>가격: <span th:text="${goods.goodsPrice}"></span></p>
<p>상품 코드: <span th:text="${goods.goodsProductCode}"></span></p>
<p>제조일: <span th:text="${goods.goodsMakeDate}"></span></p>
<p>출시일: <span th:text="${goods.goodsOutDate}"></span></p>
<p>카테고리: <span th:text="${goods.goodsCategory}"></span></p> <!-- 카테고리 추가 -->

<!-- 찜하기 버튼과 목록 버튼 -->
<button id="wishlistButton" class="btn wishlist-button" onclick="toggleWishlist(${goods.goodsNo})">찜하기</button>
<a href="/goods/list" class="btn">목록</a>

<!-- JavaScript 코드 추가 -->
<script th:inline="javascript">
  let isWished = [[${isWishlist}]]; // 서버에서 받아온 isWishlist 값
  let isLoggedIn = [[${isLoggedIn}]]; // 로그인 상태를 서버에서 받아옴
  const wishlistButton = document.getElementById('wishlistButton');

  // 초기 상태에 따른 버튼 스타일 설정
  if (isWished) {
    wishlistButton.classList.add('active');
    wishlistButton.textContent = '찜하기 취소'; // 이미 찜한 상태라면 텍스트 변경
  }

  function toggleWishlist(goodsNo) {
    // 로그인 여부 확인
    if (!isLoggedIn) {
      alert('로그인이 필요합니다.');
      window.location.href = '/login'; // 로그인 페이지로 리다이렉트
      return;
    }

    // 찜 상태에 따라 버튼 색상 및 추가/삭제 로직 처리
    if (isWished) {
      // 이미 찜한 상태에서 찜 해제
      fetch(`/wishlist/remove`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ goodsNo: goodsNo })
      })
              .then(response => {
                if (response.ok) {
                  wishlistButton.classList.remove('active'); // 색상 원복
                  wishlistButton.textContent = '찜하기'; // 텍스트 원복
                  isWished = false; // 찜 상태 업데이트
                  alert('찜하기 목록에서 제거되었습니다.');
                } else {
                  alert('찜하기 목록에서 제거하는 데 실패했습니다.');
                }
              })
              .catch(error => {
                console.error('Error:', error);
              });
    } else {
      // 찜하지 않은 상태에서 찜하기
      fetch(`/wishlist/add`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ goodsNo: goodsNo })
      })
              .then(response => {
                if (response.ok) {
                  wishlistButton.classList.add('active'); // 색상 변경
                  wishlistButton.textContent = '찜하기 취소'; // 텍스트 변경
                  isWished = true; // 찜 상태 업데이트
                  alert('찜하기 목록에 추가되었습니다!');
                } else {
                  alert('찜하기 목록에 추가하는 데 실패했습니다.');
                }
              })
              .catch(error => {
                console.error('Error:', error);
              });
    }
  }
</script>
</body>
</html>
