<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Match</title>
    <!-- ë©”ì¸ css -->
    <link rel="stylesheet" href="/css/board/board-detail.css">
    <!-- í—¤ë”/í‘¸í„° CSS-->
    <link rel="stylesheet" href="/css/header-footer.css">
</head>
<body>
<header>
    <nav>
        <div class="logo">
            <a th:href="@{/}"><img src="/img/ê³ ë§¤ì¹˜ë¡œê³ .png" alt="ì•¼êµ¬ ë¦¬ê·¸ ë¡œê³ "></a>
        </div>
        <ul class="nav-links">
            <li><a href="/game/list">ì¼ì •/ê²°ê³¼</a></li>
            <li><a href="/goods/list">êµ¿ì¦ˆ</a></li>
            <li><a href="/meeting/list">ì†Œëª¨ì„</a></li>
            <li><a href="/matchPredict">ìŠ¹ë¶€ì˜ˆì¸¡</a></li>
        </ul>
        <ul class="member-links">
            <th:block th:if="${loggedIn}">
                <li class="member-link"><a th:href="@{/member/mypage}"><span th:text="${memberNickName + ' ë‹˜'}"></span></a></li>
                <li class="member-link"><a href="#" onclick="confirmLogout(); return false;">ë¡œê·¸ì•„ì›ƒ</a></li>
            </th:block>
            <th:block th:unless="${loggedIn}">
                <li class="member-link"><a th:href="@{/member/loginpage}">ë¡œê·¸ì¸</a></li>
                <li class="member-link"><a th:href="@{/member/joinmember}">íšŒì›ê°€ì…</a></li>
            </th:block>
        </ul>
    </nav>
    <script>
        function confirmLogout() {
            if (confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                window.location.href = "/member/logout";
            }
        }
    </script>
</header>
<main>
    <aside>
        <div id="aside-main">
            <div id="aside-content">
                <span>ê²Œì‹œíŒ</span>
                <hr class="aside-header">
                <ul>
                    <li><a href="/meeting/list">ì†Œëª¨ì„</a></li>
                    <li><a href="/board/list">ê²Œì‹œíŒ</a></li>
                </ul>
            </div>
        </div>
    </aside>
    <div class="main-container">
        <div class="background-image">
            <img src="/img/baseballground.png" alt="ê²Œì‹œíŒ ë°°ê²½ ì´ë¯¸ì§€">
        </div>

        <div class="meeting-header">
            <div class="meeting-title">
                <h2 th:text="${board.meetingBoardTitle}">ê²Œì‹œê¸€ ì œëª©</h2>
                <div class="top-buttons">
                    <button th:if="${session.memberId == board.memberId}" type="button" class="button-modify" onclick="modifyBoard()">ìˆ˜ì •</button>
                    <button th:if="${session.memberId == board.memberId}" type="button" class="button-delete" onclick="deleteBoard()">ì‚­ì œ</button>
                </div>
            </div>
        </div>

        <div class="meeting-details">
            <div class="detail-item">
                <label>ì‘ì„±ì</label>
                <span th:text="${board.memberId}">ì‘ì„±ì ì•„ì´ë””</span>
            </div>
            <div class="detail-item">
                <label>ë“±ë¡ì¼</label>
                <span th:text="${#temporals.format(board.regDate, 'yyyy-MM-dd HH:mm')}">2023-01-01 12:00</span>
            </div>
            <div class="detail-item">
                <label>ì¡°íšŒìˆ˜</label>
                <span th:text="${board.meetingBoardViewCount}">123</span>
            </div>
        </div>

        <div class="meeting-content">
            <p th:utext="${board.meetingBoardContent}" class="formatted-text"></p>
        </div>

        <div class="meeting-files">
            <div id="thumbnailContainer" class="file-thumbnails">
                <div th:each="file : ${meetingBoardFile}">
                    <div class="file-thumbnail-wrapper">
                        <img th:src="${file.webPath}" alt="ì²¨ë¶€íŒŒì¼ ì¸ë„¤ì¼" class="thumbnail" onclick="openPopup(this.src)">
                    </div>
                </div>
            </div>
        </div>
        <!-- ì¢‹ì•„ìš” ë²„íŠ¼ -->

        <div class="buttons">
            <button type="button" id="likeButton" onclick="likePost()" style="display: block;">
                â¤ï¸ ì¢‹ì•„ìš” (<span id="likeCount" th:text="${likeCount}">0</span>)
            </button>
            <button type="button" id="unlikeButton" onclick="unlikePost()" style="display: none;">
                ğŸ–¤ ì¢‹ì•„ìš” ì·¨ì†Œ (<span id="likeCount" th:text="${likeCount}">0</span>)
            </button>
            <button type="button" class="button-back" onclick="history.back()">ëª©ë¡ìœ¼ë¡œ</button>
        </div>

        <div class="status-message" id="statusMessage"></div>

        <!-- ëŒ“ê¸€ ì…ë ¥ì°½ -->
        <div class="comment-section">
            <h3>ëŒ“ê¸€</h3>
            <div class="comment-input">
                <textarea id="replyText" rows="3" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                <button type="button" class="button-submit" onclick="addReply()">ëŒ“ê¸€ ë“±ë¡</button>
            </div>
            <div class="comment-list" th:if="${replies.size() > 0}">
                <div th:each="reply : ${replies}" class="comment">
                    <span th:text="${formattedRegDate}">2023-01-01 12:00</span>
                    <p th:utext="${reply.meetingReplyContent}">ëŒ“ê¸€ ë‚´ìš©</p>
                </div>
            </div>
            <div class="no-comments" th:if="${replies.size() == 0}">
                <p>ì•„ì§ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>
            </div>
        </div>

        <!-- ì´ì „ê¸€/ë‹¤ìŒê¸€ ë²„íŠ¼ -->
        <div class="pagination-buttons">
            <button th:if="${previousPostId != null}" type="button" class="button-prev" th:onclick="|location.href='/board/detail/' + ${previousPostId}|">ì´ì „ê¸€</button>
            <button th:if="${nextPostId != null}" type="button" class="button-next" th:onclick="|location.href='/board/detail/' + ${nextPostId}|">ë‹¤ìŒê¸€</button>
        </div>
    </div>
</main>
<footer class="footer-page">
    <div class="footer-content">
        <div class="logo">
            <img src="/img/ê³ ë§¤ì¹˜ë¡œê³ .png" alt="GoMatch ë¡œê³ ">
        </div>
        <div class="footer-text">
            <p>ê°œì¸ì •ë³´ ì²˜ë¦¬ë°©ì¹¨</p>
            <p>(ì‚¬)GoMatchï½œì„œìš¸ ì¢…êµ¬ ë‚¨ëŒ€ë¬¸ë¡œ 120 ëŒ€ê²½ë¹Œë”© 3ì¸µï½œ02)1544-1515</p>
            <p>Copyright Â© GoMatch</p>
        </div>
    </div>
</footer>
<script th:inline="javascript">
    const meetingBoardNo = /*[[${board.meetingBoardNo}]]*/ 0;
    console.log("ê²Œì‹œê¸€ ë²ˆí˜¸ (JavaScript ë³€ìˆ˜):", [[${board.meetingBoardNo}]]);
    function updateLikeStatus(liked) {
        document.getElementById('likeButton').style.display = liked ? 'none' : 'block';
        document.getElementById('unlikeButton').style.display = liked ? 'block' : 'none';
    }

    function likePost() {
        fetch(`/board/like/${meetingBoardNo}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(response => response.json())
            .then(data => {
                if (data.loginRequired) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }
                if (data.alreadyLiked) {
                    alert('ì´ë¯¸ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥´ì…¨ìŠµë‹ˆë‹¤.');
                    return;
                }
                if (data.liked) {
                    location.reload(); // ì¢‹ì•„ìš” í›„ ìƒˆë¡œê³ ì¹¨
                }
            })
            .catch(error => console.error('ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error));
    }

    function unlikePost() {
        fetch(`/board/unlike/${meetingBoardNo}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' }
        })
            .then(response => response.json())
            .then(data => {
                if (data.loginRequired) {
                    alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
                    return;
                }
                if (data.liked === false) {
                    location.reload(); // ì¢‹ì•„ìš” ì·¨ì†Œ í›„ ìƒˆë¡œê³ ì¹¨
                }
            })
            .catch(error => console.error('ì¢‹ì•„ìš” ì·¨ì†Œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error));
    }

    // DOMContentLoaded ì´ë²¤íŠ¸ ë°œìƒ ì‹œ ì‹¤í–‰
    document.addEventListener('DOMContentLoaded', function() {
        // ì´ˆê¸° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
        const isLiked = /*[[${isLiked}]]*/ false; // ì„œë²„ì—ì„œ ì „ë‹¬ëœ ì´ˆê¸° ì¢‹ì•„ìš” ìƒíƒœ (ì„œë²„ì—ì„œ ì„¤ì • í•„ìš”)

        document.getElementById('likeButton').style.display = isLiked ? 'none' : 'block';
        document.getElementById('unlikeButton').style.display = isLiked ? 'block' : 'none';
    });

    // ì´ë¯¸ì§€ íŒì—… ì—´ê¸°
    function openPopup(src) {
        const popup = document.getElementById('popup');
        const popupImg = document.getElementById('popup-img');
        popup.style.display = 'flex';
        popupImg.src = src;
    }

    // ì´ë¯¸ì§€ íŒì—… ë‹«ê¸°
    function closePopup() {
        const popup = document.getElementById('popup');
        popup.style.display = 'none';
    }

</script>

<!-- ì´ë¯¸ì§€ íŒì—…ì„ ìœ„í•œ ëª¨ë‹¬ -->
<div id="popup" class="popup" onclick="closePopup()">
    <img id="popup-img" class="popup-img">
</div>
</body>
</html>
